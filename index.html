<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <meta name="theme-color" content="#F7F9FC" />
  <title>家計診断アプリ</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='18' fill='%23A78BFA' fill-opacity='0.45'/%3E%3Ccircle cx='32' cy='32' r='8' fill='%2322D3EE'/%3E%3C/svg%3E" />
  <link rel="stylesheet" href="./style.css" />
</head>

<body>
<header>
  <div class="wrap">
    <h1 class="brandTitle">
      <span class="logoMark" aria-hidden="true">
        <span class="logoDot"></span>
      </span>
      家計診断アプリ
    </h1>
    <p class="muted">記録→診断。週次は「簡易スコア」、月次は「総合レポート」</p>
  </div>
</header>

<!-- Onboarding -->
<div class="modalOverlay" id="onboardingModal" style="background:rgba(15,23,42,0.55); z-index:9999;">
  <div class="modal">
    <div class="modalBody" style="padding:32px 24px; text-align:center;">
      <div id="slide1" class="onboardSlide">
        <div style="font-size:60px; margin-bottom:16px;">🩺</div>
        <h2 style="color:var(--primary); margin-bottom:12px;">このアプリは、節約アプリではありません</h2>
        <p class="muted" style="line-height:1.8; text-align:center; font-size:14px; margin-bottom:32px;">
          お金を「減らさない」ためではなく、<br>
          納得して使えるようになるためのアプリです。
        </p>
        <button class="primary" style="width:100%; padding:14px;" onclick="nextSlide(2)">次へ</button>
      </div>

      <div id="slide2" class="onboardSlide" style="display:none;">
        <div style="font-size:60px; margin-bottom:16px;">🧾</div>
        <h2 style="color:var(--primary); margin-bottom:12px;">ちゃんと管理してるのに、不安は消えない</h2>
        <p class="muted" style="line-height:1.8; text-align:center; font-size:14px; margin-bottom:32px;">
          家計簿もつけてる。<br>
          貯金もしている。<br>
          それでも「この使い方でいいのか」<br>
          わからなくなること、ありませんか？
        </p>
        <div style="display:flex; gap:12px;">
          <button class="ghost" style="flex:1;" onclick="nextSlide(1)">戻る</button>
          <button class="primary" style="flex:2;" onclick="nextSlide(3)">次へ</button>
        </div>
      </div>

      <div id="slide3" class="onboardSlide" style="display:none;">
        <div style="font-size:60px; margin-bottom:16px;">📈</div>
        <h2 style="color:var(--primary); margin-bottom:12px;">足りないのは、数字じゃなく“判断軸”</h2>
        <p class="muted" style="line-height:1.8; text-align:center; font-size:14px; margin-bottom:32px;">
          多くの家計管理は「いくら使ったか」しか見ていません。<br>
          でも本当に必要なのは<br>
          なぜ使ったか／納得できたかです。
        </p>
        <div style="display:flex; gap:12px;">
          <button class="ghost" style="flex:1;" onclick="nextSlide(2)">戻る</button>
          <button class="primary" style="flex:2;" onclick="nextSlide(4)">次へ</button>
        </div>
      </div>

      <div id="slide4" class="onboardSlide" style="display:none;">
        <div style="font-size:60px; margin-bottom:16px;">🧠</div>
        <h2 style="color:var(--primary); margin-bottom:12px;">お金の使い方を、行動と感情で見える化</h2>
        <p class="muted" style="line-height:1.8; text-align:center; font-size:14px; margin-bottom:32px;">
          金額だけでなく「納得度」で支出を評価<br>
          公的データで、今の立ち位置がわかる<br>
          我慢ではなく、質を上げる改善ができる
        </p>
        <div style="display:flex; gap:12px;">
          <button class="ghost" style="flex:1;" onclick="nextSlide(3)">戻る</button>
          <button class="primary" style="flex:2;" onclick="nextSlide(5)">次へ</button>
        </div>
      </div>

      <div id="slide5" class="onboardSlide" style="display:none;">
        <div style="font-size:60px; margin-bottom:16px;">✨</div>
        <h2 style="color:var(--primary); margin-bottom:12px;">まずは、いつも通り使ってみてください</h2>
        <p class="muted" style="line-height:1.8; text-align:center; font-size:14px; margin-bottom:32px;">
          完璧につけなくて大丈夫。<br>
          正解を探さなくて大丈夫。<br><br>
          あなたの<strong>「いつものお金の使い方」</strong>が<br>
          このアプリの診断材料になります。
        </p>
        <button class="primary" style="width:100%; padding:14px;" onclick="finishOnboarding()">はじめる</button>
      </div>
    </div>
  </div>
</div>

<!-- Result Modal -->
<div class="modalOverlay" id="resultModal">
  <div class="modal">
    <div class="modalHeader">
      <div class="modalTitle">診断結果</div>
      <div class="bar">
        <button class="ghost" onclick="copyResult()">コピー</button>
        <button class="danger" onclick="closeModal('resultModal')">閉じる</button>
      </div>
    </div>
    <div class="modalBody" id="modalResultView"></div>
    <pre id="modalResultText" style="display:none;"></pre>
  </div>
</div>

<!-- Entry Modal -->
<div class="modalOverlay" id="entryModal">
  <div class="modal modal-like-app" id="entryModalCard">

    <div class="entryTop">
      <div class="dateRow">
        <div class="dateLabel">日付</div>
        <button class="dateNavBtn" type="button" id="entryPrevDay" aria-label="prev">‹</button>
        <div class="datePill" id="entryDateText">----</div>
        <button class="dateNavBtn" type="button" id="entryNextDay" aria-label="next">›</button>
      </div>
      <p class="muted small" style="margin:10px 0 0;">入力は「カテゴリ → 金額 →（必要なら）納得」</p>
      <p class="muted small" style="margin:6px 0 0;">固定費（住居/光熱/通信/サブスク）は月次入力です</p>
    </div>

    <div class="entryMid" id="entryMid">
      <div class="entryStep" id="step-category">
        <div class="catTitle">カテゴリー</div>
        <div class="catGridApp" id="entryCatArea"></div>
      </div>

      <div class="entryStep" id="step-amount" style="display:none;">
        <div class="catTitle">支出金額</div>
        <div class="amountRow" id="amountRow">
          <div class="amountLabel">支出</div>
          <div class="amountInputWrap">
            <input id="entryAmount" type="number" inputmode="numeric" placeholder="例：1200" />
            <div class="yenSuffix">円</div>
          </div>
        </div>
      </div>

      <div class="entryStep" id="step-quality" style="display:none;">
        <div class="catTitle">納得度・きっかけ（任意）</div>
        <div class="qualityRow">
          <div class="qualityLabel">納得度</div>
          <select id="entrySat">
            <option value="">未入力</option>
            <option value="1">1（払う必要なかった）</option>
            <option value="2">2（微妙だった）</option>
            <option value="3">3（払ってよかった）</option>
            <option value="4">4（最高だった）</option>
          </select>
        </div>
        <div class="qualityRow">
          <div class="qualityLabel">きっかけ</div>
          <select id="entryTrigger">
            <option value="">未入力</option>
            <option value="tired">疲れ</option>
            <option value="stress">ストレス</option>
            <option value="hungry">空腹</option>
            <option value="reward">ご褒美</option>
            <option value="social">付き合い</option>
            <option value="timesave">時短</option>
            <option value="bored">なんとなく</option>
          </select>
        </div>
        <div style="margin-top:8px;">
          <button class="ghost" id="qualitySkipBtn" type="button">メモへスキップ</button>
        </div>
      </div>

      <div class="entryStep" id="step-memo" style="display:none;">
        <div class="catTitle">メモ（任意）</div>
        <div class="memoRow">
          <div class="memoLabel">メモ</div>
          <input id="entryMemoTop" type="text" placeholder="未入力" />
        </div>
      </div>

      <p id="entryMsg" class="muted" style="min-height:18px; margin:10px 0 0;"></p>
    </div>

    <!-- 下部操作バー（sticky） -->
    <div class="entryActionBar">
      <button class="ghost" type="button" id="entryCloseBtn">閉じる</button>
      <button class="primary" type="button" id="entryPrimaryBtn">次へ</button>
    </div>

    <input type="hidden" id="entryCategoryHidden">
    <input type="hidden" id="txDate">
  </div>
</div>

<!-- Day Detail Modal -->
<div class="modalOverlay" id="dayDetailModal">
  <div class="modal">
    <div class="modalHeader">
      <div class="modalTitle">履歴：<span id="dayDetailDateText">----</span></div>
      <button class="ghost" onclick="closeModal('dayDetailModal')">✕</button>
    </div>
    <div class="modalBody">
      <div class="bar dayDetailBar">
        <div style="font-weight:1000; color:var(--ink);" id="dayDetailSumPill">合計：0円</div>
        <div class="small" id="dayDetailCountPill">0件</div>
      </div>
      <div class="miniList" id="dayDetailList" style="max-height:60vh; overflow-y:auto;"></div>
      <div style="height:20px;"></div>
    </div>
  </div>
</div>

<!-- Saving/Invest Modal -->
<div class="modalOverlay" id="savingModal">
  <div class="modal">
    <div class="modalHeader">
      <div class="modalTitle">貯蓄・投資の入力</div>
      <button class="ghost" onclick="closeModal('savingModal')">✕</button>
    </div>
    <div class="modalBody" style="padding:16px;">
      <div class="row">
        <label>貯蓄（円）<input type="number" id="savingInput" placeholder="例：30000"></label>
        <label>投資（円）<input type="number" id="investInput" placeholder="例：20000"></label>
      </div>
      <div class="small" style="margin-top:8px;">初回だけ入力すればOK。必要なら後から編集できます。</div>
      <div style="margin-top:16px;">
        <button class="primary" style="width:100%;" onclick="saveSavingModal()">保存して結果を見る</button>
      </div>
    </div>
  </div>
</div>

<div class="wrap">
  <section class="screen active" id="screen-input">
    <div class="box">
      <h2 style="display:flex; align-items:center; gap:8px;">
        <span style="font-size:20px;">📝</span> 行動ログ
      </h2>
      <div class="small" style="margin-top:6px;">カテゴリを選ぶと入力が始まります</div>
      <div class="catTitle" style="margin-top:12px;">カテゴリー</div>
      <div class="catGridApp" id="quickCatArea"></div>
    </div>
  </section>

  <section class="screen" id="screen-list">
    <div class="box">
      <h2>📅 カレンダー</h2>
      <div class="calendarBox" id="calendarBox" style="margin-top:12px;">
        <div class="calHeader">
          <span class="pill" id="calMonthPill" style="font-size:14px; padding:6px 12px;">----</span>
          <div class="bar" style="gap:4px;">
            <button class="ghost" style="padding:8px;" onclick="calMove(-1)">◀</button>
            <button class="ghost" style="padding:8px;" onclick="calMove(1)">▶</button>
          </div>
        </div>
        <div class="calGrid" id="calDow"></div>
        <div class="calGrid" id="calGrid"></div>
      </div>
      <p style="text-align:center; margin-top:10px; font-size:12px; color:#888;">日付タップで入力 / 長押しで履歴</p>
      <div class="bar" style="margin-top:12px; justify-content:flex-end;">
         <button class="danger" style="font-size:12px; padding:8px 12px;" onclick="clearMonthTx()">月データ削除</button>
      </div>
      <div id="listArea" style="margin-top:16px;"></div>
    </div>
  </section>

  <section class="screen" id="screen-score">
    <div class="box boxSafeBottom">
      <div class="bar" style="justify-content:space-between;">
        <div>
          <h2 style="font-size:20px; margin:0;">📊 診断</h2>
          <div class="small">週次・月次の結果をここで切り替え</div>
        </div>
        <div><span class="pill" id="profileMiniPill">目安：未設定</span></div>
      </div>

      <div class="scoreTabs" style="margin-top:16px;">
        <button class="scoreTabBtn active" id="scoreTab-weekly" onclick="switchScoreView('weekly')">週次</button>
        <button class="scoreTabBtn" id="scoreTab-monthly" onclick="switchScoreView('monthly')">月次</button>
      </div>

      <div id="score-weekly" style="margin-top:16px;">
        <div id="weeklyInline"></div>
      </div>

      <div id="score-monthly" style="margin-top:16px; display:none;">
        <div class="row">
          <label>診断する月 <input type="month" id="scoreMonth"></label>
        </div>

        <h3>貯蓄・投資（初回入力）</h3>
        <div class="bar" style="justify-content:space-between; margin-top:8px;">
          <div>
            <div class="small">今月の貯蓄＋投資</div>
            <div id="savingInvestLabel" style="font-weight:1100;">—</div>
          </div>
          <button class="ghost" onclick="openSavingModal()">入力/編集</button>
        </div>
        <input type="hidden" id="savingYen">
        <input type="hidden" id="investYen">

        <div style="margin-top:22px;">
          <button class="primary" style="width:100%; padding:16px; font-size:16px;" onclick="showMonthlyScore()">診断結果を見る</button>
        </div>
      </div>
    </div>
  </section>

  <section class="screen" id="screen-profile">
    <div class="box boxSafeBottom">
      <h2>⚙️ 設定・プロフィール</h2>
      <div class="small">属性（世帯人数・年齢階級）は、将来の比較機能の土台になります</div>

      <div class="row" style="margin-top:16px;">
        <label>設定する月
          <input type="month" id="settingsMonth">
        </label>
      </div>

      <div class="row" style="margin-top:16px;">
        <label>世帯人数
          <select id="profileHousehold">
            <option value="unknown">未設定</option>
            <option value="single">1人暮らし</option>
            <option value="twoPlus">2人以上</option>
          </select>
        </label>
        <label>年齢階級
          <select id="profileAgeBand">
            <option value="unknown">未設定</option>
            <option value="u29">〜29歳</option>
            <option value="30s">30代</option>
            <option value="40s">40代</option>
            <option value="50s">50代</option>
            <option value="60p">60歳以上</option>
          </select>
        </label>
      </div>

      <div class="bar" style="margin-top:12px; justify-content:flex-end;">
        <button class="primary" onclick="saveProfile()">保存</button>
      </div>

      <div class="box" style="margin:16px 0 0;">
        <h3>月収（手取り）</h3>
        <div class="small">月次スコアの基準に使います</div>
        <div class="row" style="margin-top:12px;">
          <label>手取り月収 (円) <input type="number" id="incomeYen" placeholder="例：300000"></label>
        </div>
      </div>

      <div class="box" style="margin:16px 0 0;">
        <h3>固定費（月次）</h3>
        <div class="small">診断する月の固定費をここで入力します</div>
        <div class="row" style="margin-top:12px;">
          <label>住居費<input type="number" id="housingYen" placeholder="家賃など"></label>
          <label>光熱費<input type="number" id="utilityYen" placeholder="電気ガス水道"></label>
          <label>通信費<input type="number" id="netYen" placeholder="スマホ・Net"></label>
          <label>サブスク<input type="number" id="subYen" placeholder="定期支払"></label>
        </div>
      </div>

      <div class="box" style="margin:16px 0 0;">
        <h3>📕 チュートリアル</h3>
        <button class="ghost" style="width:100%;" onclick="resetOnboarding()">最初の説明をもう一度見る</button>
      </div>

      <div class="adminBox">
        <h3>📥 データ管理</h3>
        <div class="small" style="margin-bottom:12px;">機種変更や分析用に、全データを書き出し・読み込みできます。</div>
        <button class="dark" style="width:100%; margin-bottom:12px;" onclick="downloadData()">全データを書き出し (Export)</button>
        <input type="file" id="importFile" accept=".json" style="display:none;" onchange="importData(this)">
        <button class="ghost" style="width:100%;" onclick="document.getElementById('importFile').click()">ファイルを読み込み (Import)</button>
      </div>
    </div>
  </section>
</div>

<div class="navSpacer" aria-hidden="true"></div>

<nav class="bottomNav">
  <div class="tabs">
    <button class="tabBtn active" id="tab-input" onclick="switchScreen('input')">
      <span class="icon">✏️</span><span>ログ</span>
    </button>
    <button class="tabBtn" id="tab-list" onclick="switchScreen('list')">
      <span class="icon">📅</span><span>カレンダー</span>
    </button>
    <button class="tabBtn" id="tab-score" onclick="switchScreen('score')">
      <span class="icon">📊</span><span>スコア</span>
    </button>
    <button class="tabBtn" id="tab-profile" onclick="switchScreen('profile')">
      <span class="icon">⚙️</span><span>設定</span>
    </button>
  </div>
</nav>

<script src="./app.js"></script>
</body>
</html>
